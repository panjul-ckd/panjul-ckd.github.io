<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fnd BG Remover - Hapus & Ganti Latar Belakang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #drop-area.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
    </style>
</head>
<body class="min-h-screen text-slate-900">

    <div class="max-w-5xl mx-auto px-4 py-12">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-extrabold text-slate-900 mb-4 tracking-tight">Hapus Latar Belakang <span class="text-blue-600">Instan</span></h1>
            <p class="text-slate-600 max-w-2xl mx-auto text-lg">Gunakan teknologi AI untuk menghapus latar belakang foto Anda dalam hitungan detik dan ganti dengan warna favorit Anda.</p>
        </header>

        <main class="grid lg:grid-cols-2 gap-8">
            <!-- Bagian Kiri: Kontrol & Unggah -->
            <div class="space-y-6">
                <div id="drop-area" class="glass-card rounded-3xl p-8 border-2 border-dashed border-slate-300 text-center transition-all duration-300 relative overflow-hidden group">
                    <input type="file" id="file-input" class="hidden" accept="image/*">
                    
                    <div id="upload-placeholder" class="py-12">
                        <div class="w-20 h-20 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Klik atau Seret Gambar</h3>
                        <p class="text-slate-500">Mendukung JPG, PNG, WEBP</p>
                    </div>

                    <div id="original-preview-container" class="hidden">
                        <img id="original-preview" class="max-h-80 mx-auto rounded-xl shadow-lg mb-4" src="" alt="Original Preview">
                        <button onclick="resetUpload()" class="text-red-500 hover:text-red-600 font-medium text-sm flex items-center justify-center mx-auto gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                            Ganti Gambar
                        </button>
                    </div>
                </div>

                <!-- Kontrol Warna -->
                <div class="glass-card rounded-3xl p-6">
                    <label class="block text-sm font-semibold text-slate-700 mb-4 uppercase tracking-wider">Opsi Latar Belakang</label>
                    <div class="flex flex-wrap gap-4 items-center">
                        <div class="flex flex-wrap gap-2" id="color-presets">
                            <!-- Preset Warna -->
                            <button onclick="setColor('#ffffff')" class="w-10 h-10 rounded-full border border-slate-200 bg-white" title="Putih"></button>
                            <button onclick="setColor('#000000')" class="w-10 h-10 rounded-full border border-slate-200 bg-black" title="Hitam"></button>
                            <button onclick="setColor('#3b82f6')" class="w-10 h-10 rounded-full border border-slate-200 bg-blue-500" title="Biru"></button>
                            <button onclick="setColor('#ef4444')" class="w-10 h-10 rounded-full border border-slate-200 bg-red-500" title="Merah"></button>
                            <button onclick="setColor('#10b981')" class="w-10 h-10 rounded-full border border-slate-200 bg-emerald-500" title="Hijau"></button>
                            <button onclick="setColor('transparent')" class="w-10 h-10 rounded-full border border-slate-200 bg-slate-100 flex items-center justify-center" title="Transparan">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div class="flex items-center gap-3 ml-auto">
                            <span class="text-sm font-medium text-slate-600">Kustom:</span>
                            <input type="color" id="custom-color" class="w-10 h-10 p-0 border-0 rounded cursor-pointer bg-transparent" value="#ffffff">
                        </div>
                    </div>
                </div>

                <button id="process-btn" onclick="processImage()" disabled class="w-full py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-bold rounded-2xl shadow-xl shadow-blue-200 transition-all flex items-center justify-center gap-3">
                    <span id="btn-text">Proses Gambar</span>
                    <div id="btn-loader" class="loader hidden"></div>
                </button>
            </div>

            <!-- Bagian Kanan: Hasil -->
            <div class="flex flex-col h-full">
                <div class="glass-card rounded-3xl p-8 flex-grow flex flex-col items-center justify-center border-2 border-slate-100 relative min-h-[400px]">
                    <div id="result-placeholder" class="text-center text-slate-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 mx-auto mb-4 opacity-20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <p class="font-medium">Hasil akan muncul di sini</p>
                    </div>

                    <div id="result-container" class="hidden w-full h-full flex flex-col items-center">
                        <div id="bg-canvas-wrapper" class="relative rounded-xl shadow-2xl overflow-hidden mb-6 max-h-[500px]">
                            <img id="result-image" class="max-h-full block" src="" alt="Result Image">
                        </div>
                        
                        <div class="flex gap-4 w-full">
                            <button onclick="downloadResult()" class="flex-1 py-3 px-6 bg-slate-900 hover:bg-slate-800 text-white font-semibold rounded-xl flex items-center justify-center gap-2 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0L8 8m4-4v12" />
                                </svg>
                                Unduh PNG
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast Notification Area -->
        <div id="toast-container" class="fixed bottom-8 right-8 z-50"></div>
    </div>

    <script>
        const apiKey = ""; // API Key disediakan oleh lingkungan runtime
        const fileInput = document.getElementById('file-input');
        const dropArea = document.getElementById('drop-area');
        const originalPreview = document.getElementById('original-preview');
        const originalContainer = document.getElementById('original-preview-container');
        const uploadPlaceholder = document.getElementById('upload-placeholder');
        const processBtn = document.getElementById('process-btn');
        const resultPlaceholder = document.getElementById('result-placeholder');
        const resultContainer = document.getElementById('result-container');
        const resultImage = document.getElementById('result-image');
        const btnText = document.getElementById('btn-text');
        const btnLoader = document.getElementById('btn-loader');
        const customColor = document.getElementById('custom-color');

        let currentBase64 = null;
        let selectedColor = "#ffffff";
        let isTransparent = false;

        // Event Listeners for Upload
        dropArea.onclick = () => fileInput.click();
        
        dropArea.ondragover = (e) => {
            e.preventDefault();
            dropArea.classList.add('drag-over');
        };

        dropArea.ondragleave = () => {
            dropArea.classList.remove('drag-over');
        };

        dropArea.ondrop = (e) => {
            e.preventDefault();
            dropArea.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file) handleFile(file);
        };

        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) handleFile(file);
        };

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showToast("Tolong unggah file gambar yang valid.", "error");
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                currentBase64 = e.target.result;
                originalPreview.src = currentBase64;
                originalContainer.classList.remove('hidden');
                uploadPlaceholder.classList.add('hidden');
                processBtn.disabled = false;
                
                // Reset result if any
                resultContainer.classList.add('hidden');
                resultPlaceholder.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        function resetUpload() {
            currentBase64 = null;
            fileInput.value = "";
            originalContainer.classList.add('hidden');
            uploadPlaceholder.classList.remove('hidden');
            processBtn.disabled = true;
            resultContainer.classList.add('hidden');
            resultPlaceholder.classList.remove('hidden');
        }

        function setColor(color) {
            if (color === 'transparent') {
                isTransparent = true;
                selectedColor = "transparent";
            } else {
                isTransparent = false;
                selectedColor = color;
                customColor.value = color;
            }
            
            // Highlight selected preset (simple visual cue)
            const buttons = document.querySelectorAll('#color-presets button');
            buttons.forEach(btn => btn.classList.remove('ring-2', 'ring-blue-400', 'ring-offset-2'));
            event.target.closest('button')?.classList.add('ring-2', 'ring-blue-400', 'ring-offset-2');
        }

        customColor.oninput = (e) => {
            isTransparent = false;
            selectedColor = e.target.result;
            // Clear presets highlight
            const buttons = document.querySelectorAll('#color-presets button');
            buttons.forEach(btn => btn.classList.remove('ring-2', 'ring-blue-400', 'ring-offset-2'));
        };

        async function processImage() {
            if (!currentBase64) return;

            setLoading(true);
            const base64Data = currentBase64.split(',')[1];
            const mimeType = currentBase64.split(',')[0].split(':')[1].split(';')[0];
            
            let prompt = "Remove the background of this image and make it completely transparent. Maintain the high quality of the subject.";
            if (!isTransparent) {
                prompt = `Replace the background of this image with a solid flat ${selectedColor} background. Keep the subject unchanged and clean.`;
            }

            try {
                const response = await callGeminiAPI(prompt, base64Data, mimeType);
                if (response) {
                    resultImage.src = `data:image/png;base64,${response}`;
                    resultContainer.classList.remove('hidden');
                    resultPlaceholder.classList.add('hidden');
                    showToast("Gambar berhasil diproses!", "success");
                }
            } catch (error) {
                console.error(error);
                showToast("Terjadi kesalahan saat memproses gambar.", "error");
            } finally {
                setLoading(false);
            }
        }

        async function callGeminiAPI(prompt, base64, mimeType, retries = 0) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        { inlineData: { mimeType: mimeType, data: base64 } }
                    ]
                }],
                generationConfig: {
                    responseModalities: ['IMAGE']
                }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    if (retries < 5) {
                        const delay = Math.pow(2, retries) * 1000;
                        await new Promise(r => setTimeout(r, delay));
                        return callGeminiAPI(prompt, base64, mimeType, retries + 1);
                    }
                    throw new Error('Gagal menghubungi AI setelah beberapa percobaan.');
                }

                const data = await response.json();
                const imagePart = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData);
                return imagePart ? imagePart.inlineData.data : null;

            } catch (err) {
                if (retries < 5) {
                    const delay = Math.pow(2, retries) * 1000;
                    await new Promise(r => setTimeout(r, delay));
                    return callGeminiAPI(prompt, base64, mimeType, retries + 1);
                }
                throw err;
            }
        }

        function setLoading(loading) {
            if (loading) {
                btnText.textContent = "Memproses...";
                btnLoader.classList.remove('hidden');
                processBtn.disabled = true;
            } else {
                btnText.textContent = "Proses Gambar";
                btnLoader.classList.add('hidden');
                processBtn.disabled = false;
            }
        }

        function downloadResult() {
            if (!resultImage.src) return;
            const link = document.createElement('a');
            link.href = resultImage.src;
            link.download = 'hasil_bg_remover.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function showToast(message, type = "info") {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-emerald-500' : (type === 'error' ? 'bg-red-500' : 'bg-blue-500');
            
            toast.className = `${bgColor} text-white px-6 py-3 rounded-2xl shadow-lg mb-3 transform translate-y-10 opacity-0 transition-all duration-300 flex items-center gap-3`;
            toast.innerHTML = `
                <span class="font-medium">${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-auto hover:opacity-75">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Animation in
            setTimeout(() => {
                toast.classList.remove('translate-y-10', 'opacity-0');
            }, 10);

            // Auto remove
            setTimeout(() => {
                toast.classList.add('opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }
    </script>
</body>
</html>
