<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Foto ‚Äì Pas Foto & 4R</title>

<style>
body{
  margin:0;
  font-family:system-ui,Arial,sans-serif;
  background:#f3f5f7;
  color:#111;
}
header{
  position:sticky;top:0;
  background:#fff;
  border-bottom:1px solid #ddd;
  padding:14px;
}
h1{margin:0;font-size:18px}
.sub{font-size:12px;color:#666}

.wrap{max-width:1100px;margin:auto;padding:16px}
.grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

.card{
  background:#fff;
  border-radius:14px;
  padding:14px;
  border:1px solid #ddd;
}

button,select,input{
  padding:8px;
  border-radius:10px;
  border:1px solid #ccc;
}

button{
  cursor:pointer;
  background:#111;
  color:#fff;
  border:none;
}
button.secondary{
  background:#fff;
  color:#111;
  border:1px solid #ccc;
}

.drop{
  border:2px dashed #bbb;
  border-radius:12px;
  padding:20px;
  text-align:center;
  cursor:pointer;
}

canvas{
  width:100%;
  border-radius:12px;
  border:1px solid #ddd;
  background:#fafafa;
}

label{font-size:12px;color:#555}
.row{display:flex;gap:8px;flex-wrap:wrap}
.sep{height:1px;background:#eee;margin:12px 0}
.small{font-size:12px;color:#666}
</style>
</head>

<body>
<header>
  <h1>Edit Foto</h1>
  <div class="sub">Pas Foto Indonesia & 4R ‚Äì Gratis (GitHub Pages)</div>
</header>

<div class="wrap">
<div class="grid">

<!-- PREVIEW -->
<div class="card">
  <div class="drop" id="drop">
    <b>Upload Foto</b>
    <div class="small">Klik atau drag foto ke sini</div>
    <input type="file" id="file" accept="image/*" hidden>
  </div>

  <div class="sep"></div>

  <canvas id="cv" width="1200" height="800"></canvas>

  <div class="sep"></div>

  <div class="row">
    <button id="download">‚¨áÔ∏è Download</button>
    <button class="secondary" id="reset">‚Ü©Ô∏è Reset</button>
  </div>
</div>

<!-- CONTROL -->
<div class="card">
  <label>Ukuran Cetak</label>
  <select id="size">
    <optgroup label="Pas Foto Indonesia (300dpi)">
      <option value="2x3">2x3 cm</option>
      <option value="3x4" selected>3x4 cm</option>
      <option value="4x6cm">4x6 cm</option>
    </optgroup>
    <optgroup label="Foto Umum">
      <option value="4r">4R / 10x15 cm</option>
    </optgroup>
  </select>

  <div class="sep"></div>

  <label>Cetak Banyak di A4 (khusus pas foto)</label>
  <select id="copies">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="4">4</option>
    <option value="6" selected>6 (umum)</option>
    <option value="8">8</option>
    <option value="10">10</option>
    <option value="12">12</option>
  </select>

  <label style="margin-top:10px">Jarak antar foto</label>
  <input type="range" id="gap" min="0" max="60" value="18">

  <div class="sep"></div>

  <label>Zoom</label>
  <input type="range" id="zoom" min="1" max="2" step="0.01" value="1.15">

  <label>Geser X</label>
  <input type="range" id="panx" min="-1" max="1" step="0.01" value="0">

  <label>Geser Y</label>
  <input type="range" id="pany" min="-1" max="1" step="0.01" value="0">

  <div class="sep"></div>

  <div class="small">
    ‚úî Pas foto auto jadi A4 banyak lembar  
    ‚úî 4R hasil single  
    ‚úî Aman refresh GitHub Pages
  </div>
</div>

</div>
</div>

<script>
const cv = document.getElementById("cv");
const ctx = cv.getContext("2d");

const file = document.getElementById("file");
const drop = document.getElementById("drop");

const sizeSel = document.getElementById("size");
const copiesSel = document.getElementById("copies");
const gapSel = document.getElementById("gap");
const zoomSel = document.getElementById("zoom");
const panxSel = document.getElementById("panx");
const panySel = document.getElementById("pany");

let img = null;

const SIZE = {
  "2x3": {w:236,h:354},
  "3x4": {w:354,h:472},
  "4x6cm": {w:472,h:709},
  "4r": {w:1181,h:1772}
};

function setCanvas(w,h){
  cv.width=w;cv.height=h;
}

function drawCover(x,y,w,h){
  const iw=img.naturalWidth, ih=img.naturalHeight;
  const zoom=parseFloat(zoomSel.value);
  const panx=parseFloat(panxSel.value);
  const pany=parseFloat(panySel.value);

  const scale=Math.max(w/iw,h/ih)*zoom;
  const sw=iw*scale, sh=ih*scale;
  const dx=x+(w-sw)/2+panx*(Math.abs(w-sw)/2);
  const dy=y+(h-sh)/2+pany*(Math.abs(h-sh)/2);

  ctx.drawImage(img,dx,dy,sw,sh);
}

function render(){
  if(!img){
    setCanvas(1200,800);
    ctx.fillStyle="#fff";
    ctx.fillRect(0,0,cv.width,cv.height);
    ctx.fillStyle="#666";
    ctx.font="20px system-ui";
    ctx.fillText("Upload foto dulu bang üòÑ",40,60);
    return;
  }

  const key=sizeSel.value;
  const t=SIZE[key];
  const isPasFoto=key!=="4r";
  const copies=parseInt(copiesSel.value);
  const gap=parseInt(gapSel.value);

  if(isPasFoto && copies>1){
    setCanvas(2480,3508);
    ctx.fillStyle="#fff";
    ctx.fillRect(0,0,cv.width,cv.height);

    const map={2:[2,1],4:[2,2],6:[3,2],8:[4,2],10:[5,2],12:[4,3]};
    const [cols,rows]=map[copies]||[3,2];

    const totalW=cols*t.w+(cols-1)*gap;
    const totalH=rows*t.h+(rows-1)*gap;
    const sx=(cv.width-totalW)/2;
    const sy=(cv.height-totalH)/2;

    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const x=sx+c*(t.w+gap);
        const y=sy+r*(t.h+gap);
        ctx.save();
        ctx.beginPath();
        ctx.rect(x,y,t.w,t.h);
        ctx.clip();
        drawCover(x,y,t.w,t.h);
        ctx.restore();
      }
    }
    return;
  }

  setCanvas(t.w,t.h);
  ctx.fillStyle="#fff";
  ctx.fillRect(0,0,cv.width,cv.height);
  drawCover(0,0,cv.width,cv.height);
}

file.onchange=e=>{
  const f=e.target.files[0];
  if(!f)return;
  img=new Image();
  img.onload=render;
  img.src=URL.createObjectURL(f);
};

drop.onclick=()=>file.click();
drop.ondragover=e=>e.preventDefault();
drop.ondrop=e=>{
  e.preventDefault();
  file.files=e.dataTransfer.files;
  file.onchange({target:file});
};

[sizeSel,copiesSel,gapSel,zoomSel,panxSel,panySel].forEach(el=>{
  el.oninput=render;
});

document.getElementById("download").onclick=()=>{
  const a=document.createElement("a");
  a.href=cv.toDataURL("image/jpeg",0.95);
  a.download="hasil.jpg";
  a.click();
};

document.getElementById("reset").onclick=()=>{
  img=null;
  render();
};

render();
</script>
</body>
</html>
